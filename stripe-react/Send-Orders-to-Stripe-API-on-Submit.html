<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Stripe Payments Integration 101 Roland SzÅ‘ke January 29, 2019
(C) 2019 -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Send Orders to Stripe API on Submit (Stripe Payments Integration 101)</title>

<meta name="description" content="Send Orders to Stripe API on Submit (Stripe Payments Integration 101)">
<meta name="keywords" content="Send Orders to Stripe API on Submit (Stripe Payments Integration 101)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="CONCEPT-INDEX.html#CONCEPT-INDEX" rel="index" title="CONCEPT INDEX">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Handle-Orders-on-the-Front-End.html#Handle-Orders-on-the-Front-End" rel="up" title="Handle Orders on the Front End">
<link href="Create-a-Coupon-for-Testing.html#Create-a-Coupon-for-Testing" rel="next" title="Create a Coupon for Testing">
<link href="Add-Products-to-the-Webshop.html#Add-Products-to-the-Webshop" rel="prev" title="Add Products to the Webshop">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="Send-Orders-to-Stripe-API-on-Submit"></a>
<div class="header">
<p>
Next: <a href="Create-a-Coupon-for-Testing.html#Create-a-Coupon-for-Testing" accesskey="n" rel="next">Create a Coupon for Testing</a>, Previous: <a href="Add-Products-to-the-Webshop.html#Add-Products-to-the-Webshop" accesskey="p" rel="prev">Add Products to the Webshop</a>, Up: <a href="Handle-Orders-on-the-Front-End.html#Handle-Orders-on-the-Front-End" accesskey="u" rel="up">Handle Orders on the Front End</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="CONCEPT-INDEX.html#CONCEPT-INDEX" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Send-Orders-to-Stripe-API-on-Submit-1"></a>
<h4 class="subsection">4.2.5 Send Orders to Stripe API on Submit</h4>

<a name="index-orders_002c-send"></a>
<a name="index-send-orders"></a>
<a name="index-API_002c-send-orders-to"></a>
<a name="index-total-price-of-orders_002c-automatic-calculation"></a>
<p>We are ready to send orders to our express API on submit. We do
not have to calculate the total price of orders from now
on. Stripe can sum it up for us, based on the SKUs, quantities,
and coupons.
</p>
<a name="index-Shop_002ejs-7"></a>
<a name="index-post_002c-axios-1"></a>
<a name="index-order_002c-send-in-code"></a>
<div class="example">
<pre class="example"> 1  // Shop.js
 2  handleSubmit(evt) {
 3    evt.preventDefault()
 4    this.setState({fetching: true})
 5    const state = this.state
 6    const cart = state.cart
 7  
 8    this.props.stripe.createToken({name: state.name}).then(({token}) =&gt; {
 9      // Create order
10      const order = {
11        currency: 'usd',
12        items: Object.keys(cart).filter((name) =&gt; cart[name] &gt; 0
13           ? true : false).map(name =&gt; {
14          return {
15            type: 'sku',
16            parent: skus[name],
17            quantity: cart[name]
18          }
19        }),
20        email: state.email,
21        shipping: {
22          name: state.name,
23          address: state.address
24        }
25      }
26      // Add coupon if given
27      if (state.coupon) {
28        order.coupon = state.coupon
29      }
30      // Send order
31      axios.post(`http://localhost:3001/api/shop/order`, {order, source: token.id})
32      .then(() =&gt; {
33        this.setState({fetching: false})
34        alert(`Thank you for your purchase!`)
35      })
36      .catch(error =&gt; {
37        this.setState({fetching: false})
38        console.log(error)
39      })
40    }).catch(error =&gt; {
41      this.setState({fetching: false})
42      console.log(error)
43    })
44  }
</pre></div>




</body>
</html>
